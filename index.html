<!DOCTYPE html>
<html lang="th">
<head>
    </head>
<body>
    <div class="app-container" id="app"></div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwuVVCR9i1oFtWdQ7GgJEBhjBPmYEQOmb809h-c-kSCM9JyYG1rKIeFXDo0AvvZttcZ/exec"; // **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!**
    let session = { token: null, user: null };

    // ... (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô apiCall, renderLoginView, handleLogin, logout ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...

    function renderLeaveFormView() {
        const app = document.getElementById('app');
        app.innerHTML = `
            <div class="view-container">
                <div class="d-flex justify-content-between align-items-center"><h2>üìù ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤</h2><button onclick="logout()" class="btn btn-sm btn-outline-danger">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></div>
                <p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <strong>${session.user.name}</strong></p>
                
                <div id="leave-balance" class="card mb-3"><div class="card-body">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ß‡∏±‡∏ô‡∏•‡∏≤...</div></div>

                <form id="leaveForm">
                    </form>
                <div id="statusMessage" class="mt-3"></div>
                <div class="nav-links">
                    ${(session.user.isManager || session.user.isHR) ? '<a href="#" onclick="renderDashboardView()">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>' : ''}
                </div>
            </div>
        `;
        document.getElementById('leaveForm').addEventListener('submit', handleLeaveSubmit);
        loadLeaveBalance(); // **NEW: Call function to load balance**
    }

    async function loadLeaveBalance() {
        try {
            const balance = await apiCall('getLeaveBalance');
            const balanceDiv = document.getElementById('leave-balance');
            balanceDiv.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h5>
                    <p class="card-text mb-1">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô: <strong>${balance.annual.remaining}</strong> / ${balance.annual.total} ‡∏ß‡∏±‡∏ô</p>
                    <p class="card-text">‡∏•‡∏≤‡∏Å‡∏¥‡∏à: <strong>${balance.personal.remaining}</strong> / ${balance.personal.total} ‡∏ß‡∏±‡∏ô</p>
                </div>
            `;
        } catch (error) {
            document.getElementById('leave-balance').innerText = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÑ‡∏î‡πâ';
        }
    }

    function renderDashboardView() {
        let title = session.user.isHR ? "üëë ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î HR (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)" : "üëë ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏•‡∏≤";
        // ... (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á renderDashboardView ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
    }
    
    // ... (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...

</script>
</body>
</html>
